<!DOCTYPE html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div layout:fragment="content" th:remove="tag">
    <th:block th:replace="layout/header :: header(${page?.nav})"/>
    <div id="main_contents">
        <!-- [Alarm 설정 목록] start -->
        <div class="row">
            <div class="main_title_top col-xs-12 pr_0" ><i class="feather icon-chevrons-right"></i> Alarm 설정 목록
                <div class="f_r">
                    <div class="d_ib">
                        <button class="btn btn-md btn-outline-white" id="btnNew"><i class="feather icon-file-text"></i> NEW</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="box_panel">
                <div class="box_panel-total">
                    Total : <span th:text="${#arrays.isEmpty(alertConfigList) ? '0' : alertConfigList.size()}" class="point pr_10"></span>
                </div>
                <div class="box_table-body">
                    <table class="list_table70vh">
                        <thead>
                            <tr>
                                <th>Rule ID</th>
                                <th>Detect type</th>
                                <th>Category</th>
                                <th>Resource</th>
                                <th>Danger (%)</th>
                                <th>Warning (%)</th>
                                <th>Duration (min)</th>
                                <th>Detect string</th>
                                <th>Severity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#arrays.isEmpty(alertConfigList)}">
                                <td colspan="5" class="text-center">No results</td>
                            </tr>
                            <tr th:unless="${#arrays.isEmpty(alertConfigList)}" th:each="alertConfig : ${alertConfigList}">
                                <td>
                                    <a class="table2-link" th:href="'javascript:alertConfigDetail(&quot;' + ${alertConfig?.ruleId} + '&quot;)'"
                                       th:text="${alertConfig?.ruleId}"></a>
                                </td>
                                <td th:text="${alertConfig?.detectType}"></td>
                                <td th:text="${alertConfig?.category}"></td>
                                <td th:text="${alertConfig?.resource}"></td>
                                <td th:text="${alertConfig?.dangerLevel}"></td>
                                <td th:text="${alertConfig?.warningLevel}"></td>
                                <td th:text="${alertConfig?.duration}"></td>
                                <td th:text="${alertConfig?.detectString}"></td>
                                <td th:text="${alertConfig?.severity}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- [Modal 메트릭] start -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
            <div th:fragment="modalContents" class="modal-dialog modal-lg" style="width:765px;">
                <div class="modal-content">
                    <div class="modal-title_box">
                        <div class="modal-title">
                            <button type="button" class="close px-3" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <span id="myModalLabel">Rule config</span>
                            <div class="f_r"><button class="btn_save_i feather icon-save" id="save"></button></div>
                        </div>
                    </div>
                    <div class="modal-nbody row_scroll">
                        <div class="row">
                            <form id="alertRule" th:object="${alertRule}" method="POST">
                            <table class="table-nt">
                                <tr>
                                    <th>Rule ID</th>
                                    <td><input type="text" id="ruleId" style="width:60px;"></td>
                                </tr>
                                <tr>
                                    <th>Detect Type</th>
                                    <td>
                                        <div class="radio">
                                            <label><input type="radio" id="detectType" name="detectType" value="metric" checked>Metric</label>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <label><input type="radio" id="detectType" name="detectType" value="log">Log</label>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Category</th>
                                    <td>
                                        <div class="dropdown d_ib">
                                            <select class="custom-select" id="category">
                                                <option value="cluster node">Cluster Node</option>
                                                <option value="pod">POD</option>
                                                <option value="cluster Event">Cluster Event</option>
                                                <option value="log">Log</option>
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="logConfigArea1">
                                    <th>Resource</th>
                                    <td>
                                        <div class="dropdown d_ib">
                                            <select class="custom-select" id="resource">
                                                <option value="CPU">CPU</option>
                                                <option value="Memory">Memory</option>
                                                <option value="Disk">Disk</option>
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="logConfigArea2">
                                    <th>Danger Level</th>
                                    <td><input type="text" id="maxLevel" style="width:60px;"> %</td>
                                </tr>
                                <tr id="logConfigArea3">
                                    <th>Warning Level</th>
                                    <td><input type="text" id="minLevel" style="width:60px;"> %</td>
                                </tr>
                                <tr id="logConfigArea4">
                                    <th>Duration</th>
                                    <td><input type="text" id="duration" style="width:60px;"> min</td>
                                </tr>
                                <tr id="logConfigArea5">
                                    <th>Detect string</th>
                                    <td><input type="text" id="detectString" style="width:200px;"></td>
                                </tr>
                                <tr id="logConfigArea6">
                                    <th>Severity</th>
                                    <td>
                                        <div class="checkbox">
                                            <label><input type="checkbox" id="severity" value="Danger">Danger</label>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <label><input type="checkbox" id="severity" value="Warning">Warning</label>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <label><input type="checkbox" id="severity" value="Info">Info</label>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- [Modal 메트릭] End
    < !-- [Alarm 설정 목록] End-->
    </div>
    <script type="text/javascript" th:inline="javascript">
        var $contentList = $("#contentList"),
            linkUrl= [[${link}]];

        function alertConfigDetail(ruleId) {
            $.ajax({
                url: "/setting/alarm/list/config/" + ruleId,
                success: function (data) {
                    $('#myModal').text("");
                    $('#myModal').html(data);
                    $('#myModal').modal();
                    $(".knob").knob();
                },
                error: function (e) {
                    if (e.status === 401) {
                        $(location).attr('href', '/login?logout')
                    }
                }
            });
        }
        $(document).ready(function () {
            $('#btnNew').on('click', function () {
                $('#myModal').modal();
                $('#logConfigArea1').show();
                $('#logConfigArea2').show();
                $('#logConfigArea3').show();
                $('#logConfigArea4').show();
                $('#logConfigArea5').hide();
                $('#logConfigArea6').hide();
            });
        });

        $('#save').click(function () {
            $('#alertRule').attr("action", "/setting/alarm");
            var data = $('#alertRule').serialize();

            alert("new rule : "+data);

            $.ajax({
                type : "post",
                data : data,
                url : "/setting/alarm",
                success : function(){
                    alert('등록이 완료되었습니다.');
                    $('#myModal').hide();
                    $(location).attr('href', 'setting/alarm/setting-alarm-list')
                }
            });

            // let ruleId        = $('#ruleId').val();
            // let detectType    = $('#detectType:checked').val();
            // let category      = $('#category option:selected').val();
            // let resource      = $('#resource').val();
            // let dangerLevel   = $('#dangerLevel').val();
            // let warningLevel  = $('#warningLevel').val();
            // let duration      = $('#duration').val();
            // let severity      = $('#severity:checked').val();
            //
            // alert("save click : "+severity);
            //
            // $.ajax({
            //     url: '/setting/alarm/config/', // 서버 요청
            //     dataType: 'json',
            //     type: 'post',
            //     data: {
            //         'ruleId': ruleId,
            //         'detectType': detectType,
            //         'category': category,
            //         'resource': resource,
            //         'dangerLevel': dangerLevel,
            //         'warningLevel': warningLevel,
            //         'duration': duration,
            //         'severity': severity
            //     },
            //     success: function () {
            //         alert('Success'); // 성공시 코드
            //     }
            // });

        });
        $('input[type=radio][name=detectType]').change(function() {
            switch(this.value) {
                case 'metric' :
                    $('#logConfigArea1').show();
                    $('#logConfigArea2').show();
                    $('#logConfigArea3').show();
                    $('#logConfigArea4').show();
                    $('#logConfigArea5').hide();
                    $('#logConfigArea6').hide();
                    break;
                case 'log' :
                    $('#logConfigArea1').hide();
                    $('#logConfigArea2').hide();
                    $('#logConfigArea3').hide();
                    $('#logConfigArea4').hide();
                    $('#logConfigArea5').show();
                    $('#logConfigArea6').show();
                    break;
            }
        });
    </script>
</div>
</body>
</html>