<!DOCTYPE html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div layout:fragment="content" th:remove="tag">

    <th:block th:replace="layout/header :: header(navTitle='Home<i class=&quot;feather icon-chevron-right&quot; ></i>Monitoring<i class=&quot;feather icon-chevron-right&quot; ></i>Database')"/>
    <div id="main_contents">
        <div th:if="${defaultVariable!= null}" class="row">
            <div class="main_title_top"><i class="feather icon-chevrons-right"></i> 보험코어 데이터베이스</div>
        </div>
        <div th:if="${defaultVariable!= null && defaultVariable?.values.size() > 1}"
             th:with="colDivide=${12 / defaultVariable?.values.size()}"
             class="row">
            <div th:each="item,index : ${defaultVariable?.values}"
                 th:with="variable=${'&var-' + defaultVariable.getName() + '=' + item.split(':')[0]}"
                 th:classappend="|col-lg-${colDivide}|"
                 class="col-md-12">
                <div class="col-xs-12 box1_pb15">
                    <div class="row col-xs-6">
                        <div th:text="|Node[${item.split(':')[0]}]|" class="title col-xs-12">RAC Node#1</div>
                    </div>
                    <div class="row col-xs-6">
                        <div class="col-xs-12 box_up"
                             th:if="${#strings.equalsIgnoreCase(@proxyApiService.singleValueByQuery(#strings.replace(nodePanelMap.get(1L).getSrc(), '$' + defaultVariable.getName(), item.split(':')[0])), '1')}">UP</div>
                        <div class="col-xs-12 box_down"
                             th:unless="${#strings.equalsIgnoreCase(@proxyApiService.singleValueByQuery(#strings.replace(nodePanelMap.get(1L).getSrc(), '$' + defaultVariable.getName(), item.split(':')[0])), '1')}">DOWN</div>
                    </div>
                    <div class="row col-xs-6">
                        <div class="col-xs-12">
                            <div class="embed-responsive embed-responsive-16by9-xs">
                                <iframe th:src="${nodePanelMap.get(2L).getSrc() + variable}"
                                        class="embed-responsive-item" allowfullscreen=""></iframe>
                            </div>
                        </div>
                    </div>
                    <div class="row col-xs-6">
                        <div class="col-xs-12">
                            <div class="embed-responsive embed-responsive-16by9-xs">
                                <iframe th:src="${nodePanelMap.get(3L).getSrc() + variable}"
                                        class="embed-responsive-item" allowfullscreen=""></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" th:if="${defaultVariable!= null && defaultVariable?.values.size() == 1}"
             th:with="variable=${'&var-' + defaultVariable.getName() + '=' + defaultVariable.getValues().get(0).split(':')[0]}">
            <div th:switch="${@proxyApiService.singleValueByQuery(#strings.replace(nodePanelMap.get(1L).getSrc(), '$' + defaultVariable.getName(), defaultVariable.getValues().get(0).split(':')[0]))}" class="col-lg-3">
                <div class="box_normal">
                    <div th:case="'1'" class="b_txt1 text-center">UP</div>
                    <div th:case="*" class="b_txt1 text-center">DOWN</div>
                </div>
            </div>
            <div th:switch="${nodePanelMap.get(2L).getDataType()}" class="col-lg-3">
                <div th:case="'iframe'" class="col-md-12">
                    <div class="col-xs-12 box_panel">
                        <div class="embed-responsive embed-responsive-16by9-xs">
                            <iframe class="embed-responsive-item" th:src="${nodePanelMap.get(2L).getSrc() + variable}" allowfullscreen=""></iframe>
                        </div>
                    </div>
                </div>
                <div th:case="*" class="box_normal"><!-- normal box -->
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="title">Avg.CPU</div>
                            <div class="stitle"></div>
                            <div class="b_txt">Normal<span class="b_stxt"></span></div>
                        </div>
                        <div class="col-xs-6 text-right">
                            <input class="knob" data-width="96" data-angleoffset="0" data-thickness=".2" data-fgcolor="#007219"  data-bgcolor="#7cb78a"  value="35" style="">
                        </div>
                    </div>
                </div>
            </div>
            <div th:switch="${nodePanelMap.get(3L).getDataType()}" class="col-lg-3">
                <div th:case="'iframe'" class="col-md-12">
                    <div class="col-xs-12 box_panel">
                        <div class="embed-responsive embed-responsive-16by9-xs">
                            <iframe class="embed-responsive-item" th:src="${nodePanelMap.get(3L).getSrc() + variable}" allowfullscreen=""></iframe>
                        </div>
                    </div>
                </div>
                <div th:case="*" class="box_danger"><!-- danger box -->
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="title">Avg.Memory</div>
                            <div class="stitle"></div>
                            <div class="b_txt">Danger<span class="b_stxt"></span></div>
                        </div>
                        <div class="col-xs-6 text-right">
                            <input class="knob" data-width="96" data-angleoffset="0" data-thickness=".2" data-fgcolor="#cd2b30"  data-bgcolor="#e88071"  value="90" style="">
                        </div>
                    </div>
                </div>
            </div>
            <div th:switch="${nodePanelMap.get(4L).getDataType()}" class="col-lg-3">
                <div th:case="'iframe'" class="col-md-12">
                    <div class="col-xs-12 box_panel">
                        <div class="embed-responsive embed-responsive-16by9-xs">
                            <iframe class="embed-responsive-item" th:src="${nodePanelMap.get(4L).getSrc() + variable}" allowfullscreen=""></iframe>
                        </div>
                    </div>
                </div>
                <div th:case="*" class="box_warning"><!-- warning box -->
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="title">Avg.Disk</div>
                            <div class="stitle"></div>
                            <div class="b_txt">Warning<span class="b_stxt"></span></div>
                        </div>
                        <div class="col-xs-6 text-right">
                            <input class="knob" data-width="96" data-angleoffset="0" data-thickness=".2" data-fgcolor="#e08e00"  data-bgcolor="#f9d390"  value="68" style="">
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="main_panels">
            <div class="row">
                <div class="main_title">
                    <div id="namespace" class="d-inline"
                         th:utext="|<i class='feather icon-chevrons-right'></i> 보험코어 데이터베이스 Status ${defaultVariable?.values?.get(0) != null ? '[' + defaultVariable?.values?.get(0) + ']' : ''}|">
                        보험코어 데이터베이스 Status
                    </div>
                    <div th:if="${defaultVariable != null}" class="f_r">
                        <div th:each="template : ${templating.values()}" class="dropdown d_ib">
                            <select th:name="|var-${template?.name}|" th:id="|var-${template?.name}|"
                                    th:disabled="${template?.values == null ? 'true' : 'false'}" class="custom-select">
                                <option value="" selected disabled hidden> -- select variable -- </option>
                                <option th:each="value : ${template?.values}"
                                        th:value="${value}" th:text="${value}"
                                        th:selected="${#strings.equalsIgnoreCase(defaultVariable?.values?.get(0), value)}" value="">value</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div th:switch="${panelMap.get(5L).getDataType()}" class="col-md-12 col-lg-15" >
                    <div th:case="'iframe'" class="col-md-12">
                        <div class="col-xs-12 box_panel">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe class="embed-responsive-item" th:src="${panelMap.get(5L).getSrc()}" allowfullscreen=""></iframe>
                            </div>
                        </div>
                    </div>
                    <div th:case="*" class="col-xs-12 box_chart">
                        <div class="title_chart_c">Exeute Count</div>
                        <div class="t_chart text-center">000<span class="t_sstxt2">k</span></div>
                    </div>
                </div>
                <div th:switch="${panelMap.get(6L).getDataType()}" class="col-md-12 col-lg-15" >
                    <div th:case="'iframe'" class="col-md-12">
                        <div class="col-xs-12 box_panel">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe class="embed-responsive-item" th:src="${panelMap.get(6L).getSrc()}" allowfullscreen=""></iframe>
                            </div>
                        </div>
                    </div>
                    <div th:case="*" class="col-xs-12 box_chart">
                        <div class="title_chart_c">Number of Commit</div>
                        <div class="t_chart text-center">000</div>
                    </div>
                </div>
                <div th:switch="${panelMap.get(7L).getDataType()}" class="col-md-12 col-lg-15" >
                    <div th:case="'iframe'" class="col-md-12">
                        <div class="col-xs-12 box_panel">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe class="embed-responsive-item" th:src="${panelMap.get(7L).getSrc()}" allowfullscreen=""></iframe>
                            </div>
                        </div>
                    </div>
                    <div th:case="*" class="col-xs-12 box_chart">
                        <div class="title_chart_c">Active Session</div>
                        <div class="t_chart text-center">000</div>
                    </div>
                </div>
                <div th:switch="${panelMap.get(8L).getDataType()}" class="col-md-12 col-lg-15" >
                    <div th:case="'iframe'" class="col-md-12">
                        <div class="col-xs-12 box_panel">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe class="embed-responsive-item" th:src="${panelMap.get(8L).getSrc()}" allowfullscreen=""></iframe>
                            </div>
                        </div>
                    </div>
                    <div th:case="*" class="col-xs-12 box_chart">
                        <div class="title_chart_c">Process count</div>
                        <div class="t_chart text-center">000</div>
                    </div>
                </div>
                <div th:switch="${panelMap.get(9L).getDataType()}" class="col-md-12 col-lg-15" >
                    <div th:case="'iframe'" class="col-md-12">
                        <div class="col-xs-12 box_panel">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe class="embed-responsive-item" th:src="${panelMap.get(9L).getSrc()}" allowfullscreen=""></iframe>
                            </div>
                        </div>
                    </div>
                    <div th:case="*" class="col-xs-12 box_chart">
                        <div class="title_chart_c">User Rollback</div>
                        <div class="t_chart text-center">000</div>
                    </div>
                </div>
            </div>
            <!--        <div class="row row_scroll">-->
            <div class="row">

                <div class="row">
                    <div th:switch="${panelMap.get(10L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(10L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">Concurrent wait time</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart4.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                    <div th:switch="${panelMap.get(11L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(11L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">Commit wait time</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart3.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                    <div th:switch="${panelMap.get(12L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(12L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">Application waiting</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart2.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                    <div th:switch="${panelMap.get(13L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(13L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">Network waiting</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart1.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div th:switch="${panelMap.get(14L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(14L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">System I/O wait</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart1.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                    <div th:switch="${panelMap.get(15L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(15L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">User I/O wait</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart2.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                    <div th:switch="${panelMap.get(16L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(12L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">Configuring wait</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart3.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                    <div th:switch="${panelMap.get(17L).getDataType()}" class="col-md-12 col-lg-3">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(17L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">Scheduler wait</div>
                            <div class="box_panel-body">
                                <img th:src="@{/assets/img/chart4.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div th:switch="${panelMap.get(18L).getDataType()}" class="col-md-12 col-lg-12">
                        <div th:case="'iframe'" class="col-md-12">
                            <div class="col-xs-12 box_panel">
                                <div class="embed-responsive embed-responsive-16by9-xxs">
                                    <iframe class="embed-responsive-item" th:src="${panelMap.get(18L).getSrc()}" allowfullscreen=""></iframe>
                                </div>
                            </div>
                        </div>
                        <div th:case="*" class="box_panel">
                            <div class="box_panel-heading">Resource utilization</div>
                            <div class="box_panel-body" >
                                <img th:src="@{/assets/img/chart5.jpg}" class="img-responsive" alt="" style="width:100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [보험코어 데이터베이스 [Oracle ver x.x]] END -->

            <!-- [Table spaces] Start -->
            <div th:switch="${panelMap.get(19L).getDataType()}" class="row col-lg-12" >
                <div th:case="'iframe'" class="col-md-12">
                    <div class="col-xs-12 box_panel">
                        <div class="embed-responsive embed-responsive-16by9-xxs">
                            <iframe class="embed-responsive-item" th:src="${panelMap.get(19L).getSrc()}" allowfullscreen=""></iframe>
                        </div>
                    </div>
                </div>
                <div th:case="*" class="box_panel">
                    <div class="box_panel-heading">Table spaces</div>
                    <div class="box_panel-body">
                        <table class="table table-striped text-center">
                            <thead>
                            <tr>
                                <th>Table name</th>
                                <th>Alloc.space</th>
                                <th>Free space</th>
                                <th>Used</th>
                                <th>Max size Autoextend</th>
                                <th>Percent used Extend</th>
                                <th>Time</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>SYSTEM</td>
                                <td>000.00MB</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>2020-05-22 12:42:13</td>
                            </tr>
                            <tr>
                                <td>SYSTEM</td>
                                <td>000.00MB</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>2020-05-22 12:42:13</td>
                            </tr>
                            <tr>
                                <td>SYSTEM</td>
                                <td>000.00MB</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>2020-05-22 12:42:13</td>
                            </tr>
                            <tr>
                                <td>SYSTEM</td>
                                <td>000.00MB</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>000.00MB</td>
                                <td>00%</td>
                                <td>2020-05-22 12:42:13</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- [Table spaces] END -->

            <!-- [Errors] Start -->
            <div class="row col-lg-12" >
                <div class="box_panel">
                    <div class="box_panel-heading">Errors</div>
                    <div class="box_panel-body">
                        <table class="table table-striped text-center">
                            <thead>
                            <tr>
                                <th>Time</th>
                                <th>Error code</th>
                                <th>Insatance</th>
                                <th>Description</th>
                                <th>Host</th>
                                <th>Count</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>2020-05-22 12:42:13</td>
                                <td>ORA-0000</td>
                                <td>XXXX</td>
                                <td>ORA-0000:////</td>
                                <td>HLIXXX</td>
                                <td>000</td>
                            </tr>
                            <tr>
                                <td>2020-05-22 12:42:13</td>
                                <td>ORA-0000</td>
                                <td>XXXX</td>
                                <td>ORA-0000:////</td>
                                <td>HLIXXX</td>
                                <td>000</td>
                            </tr>
                            <tr>
                                <td>2020-05-22 12:42:13</td>
                                <td>ORA-0000</td>
                                <td>XXXX</td>
                                <td>ORA-0000:////</td>
                                <td>HLIXXX</td>
                                <td>000</td>
                            </tr>
                            <tr>
                                <td>2020-05-22 12:42:13</td>
                                <td>ORA-0000</td>
                                <td>XXXX</td>
                                <td>ORA-0000:////</td>
                                <td>HLIXXX</td>
                                <td>000</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- [Table spaces] END -->
        </div>
    </div>
    <script th:src="@{/assets/js/variables.js}"></script>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        var templating = new Map(Object.entries([[${templating}]])),
            optionTitle = "<option value=\"\" selected disabled hidden> -- select variable -- </option>";
        /*]]>*/

        $(function() {
            $("select[name^='var-']").change(function () {
                const selectId = comnJs.replace($(this).attr('id'), 'var-', '');

                let edgeFields = templating.get(selectId).edgeFields;
                if (edgeFields.length) {
                    // template-variable 데이터 채우기
                    for (const edgeField of edgeFields) {
                        variablesJs.setEdgeFieldValue(selectId, edgeField);
                    }
                } else {
                    // 페이지 reloading
                    console.log("reloading!!!");
                    variablesJs.reloadPanel("#main_panels iframe");
                }
            });
        });
    </script>

</div>
</body>
</html>