server:
  port: 8080

spring:
  application:
    name: kube-watcher
  jackson:
    default-property-inclusion: non_null
    serialization:
      indent-output: false
      write-dates-as-timestamps: false
    deserialization:
      fail-on-ignored-properties: false
      fail-on-unknown-properties: false
    property-naming-strategy: LOWER_CAMEL_CASE
    date-format: com.fasterxml.jackson.databind.util.StdDateFormat
  thymeleaf:
    cache: false
  main:
    allow-bean-definition-overriding: true

  datasource:
    initialization-mode: never
    driver-class-name: org.h2.Driver
    url: jdbc:h2:/opt/kube-watcher/data/kw-data;AUTO_SERVER=true;MODE=MySQL
    username: admin
    password: password
    hikari:
      connection-init-sql: ""
      auto-commit: true
      minimum-idle: 10
      maximum-pool-size: 10
      data-source-properties:
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true
  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        web-allow-others: true
  jpa:
    database: h2
    generate-ddl: false # db schema 생성 여부
    show-sql: true
    hibernate:
      ddl-auto: create

    properties:
      hibernate.format_sql: true
      hibernate.use_sql_comments: true
      hibernate.hbm2ddl.charset_name: UTF-8
      hibernate.hbm2ddl.import_files: classpath:sql/common-import.sql,classpath:sql/default-import.sql
    database-platform: org.hibernate.dialect.MySQL5InnoDBDialect

  task:
    scheduling:
      pool:
        size: 10
      shutdown:
        await-termination: true
        await-termination-period: 30s

mybatis:
  executor-type: simple
  configuration:
    cache-enabled: false
    lazy-loading-enabled: false
    aggressive-lazy-loading: false
    default-statement-timeout: 5
    jdbc-type-for-null: NULL
    call-setters-on-nulls: true
    map-underscore-to-camel-case: true
#  type-handlers-package: com.kubeworks.watcher.data.typehandler

management:
  endpoints:
    web:
      exposure:
        include: health, info, prometheus, routes
  metrics:
    export:
      prometheus:
        enabled: true

zuul:
  retryable: true
  force-original-query-string-encoding: true
  host:
    connection-request-timeout-millis: 3000
    connect-timeout-millis: 2000
    max-per-route-connections: 20
    max-total-connections: 500

ribbon:
  okhttp:
    enabled: true

application:
  properties:
    root-domain: ''
    monitoring:
      default-cluster-name: local
      clusters:
        local:
          cluster-name: local
          # modified to set k8s url and token from environment variables 
          # initial value from configmap - kube-watcher-config
          k8s:
            url: ${KUBERNETES_SERVICE_URL}
            api-token: ${KUBERNETES_SERVICE_TOKEN}
          prometheus:
            proxy: true
            url: ${PROMETHEUS_SERVICE_URL}
          loki:
            proxy: true
            url: ${LOKI_SERVICE_URL}
logging:
  level:
    root: info
    com.squareup.okhttp3: debug
    com.kubeworks.watcher.ecosystem.prometheus.feign.PrometheusFeginClient: info
